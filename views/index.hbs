<div class="hero-section">
  <div class="hero-content">
    <h1 class="hero-title">Moodle</h1>
    <p class="hero-subtitle">Learning platform for SETU students</p>
  </div>
</div>

<div class="file-upload-section">
  <div class="file-upload-container">
    <h2 class="file-upload-title">Upload Files to S3</h2>
    <p class="file-upload-subtitle">Upload your files directly here</p>
    
    <div class="upload-area" id="upload-area">
      <input type="file" id="file-input" multiple style="display: none;" />
      <div class="upload-content">
        <svg class="upload-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="17 8 12 3 7 8"></polyline>
          <line x1="12" y1="3" x2="12" y2="15"></line>
        </svg>
        <p class="upload-text">Drag and drop files here</p>
        <p class="upload-hint">Maximum file size: 10MB per file</p>
      </div>
    </div>

    <div class="upload-progress-container" id="upload-progress-container" style="display: none;">
      <div class="upload-progress-header">
        <span>Uploading files...</span>
        <span class="upload-progress-count" id="upload-progress-count"></span>
      </div>
      <div class="upload-progress-list" id="upload-progress-list"></div>
    </div>

    <div class="upload-results" id="upload-results" style="display: none;">
      <div class="upload-results-header">
        <h3>Uploaded Files</h3>
        <button class="btn btn-secondary" id="clear-results-btn">Clear</button>
      </div>
      <div class="upload-results-list" id="upload-results-list"></div>
    </div>

    <div class="upload-message" id="upload-message"></div>
  </div>
</div>

<style>
  /* Modern Design System */
  :root {
    /* Colors */
    --primary-50: #eff6ff;
    --primary-100: #dbeafe;
    --primary-500: #3b82f6;
    --primary-600: #2563eb;
    --primary-700: #1d4ed8;
    --primary-900: #1e3a8a;
    
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-400: #9ca3af;
    --gray-500: #6b7280;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-800: #1f2937;
    --gray-900: #111827;
    
    --success-50: #f0fdf4;
    --success-500: #22c55e;
    --success-600: #16a34a;
    
    --error-50: #fef2f2;
    --error-500: #ef4444;
    --error-600: #dc2626;
    
    /* Spacing */
    --space-1: 0.25rem;
    --space-2: 0.5rem;
    --space-3: 0.75rem;
    --space-4: 1rem;
    --space-5: 1.25rem;
    --space-6: 1.5rem;
    --space-8: 2rem;
    --space-10: 2.5rem;
    --space-12: 3rem;
    --space-16: 4rem;
    --space-20: 5rem;
    
    /* Typography */
    --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    --font-mono: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
    
    /* Shadows */
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
    
    /* Border radius */
    --radius-sm: 0.375rem;
    --radius: 0.5rem;
    --radius-md: 0.75rem;
    --radius-lg: 1rem;
    --radius-xl: 1.5rem;
    --radius-2xl: 2rem;
    
    /* Transitions */
    --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Base styles */
  * {
    box-sizing: border-box;
  }

  body {
    font-family: var(--font-sans);
    line-height: 1.6;
    color: var(--gray-800);
    background: linear-gradient(135deg, var(--gray-50) 0%, var(--primary-50) 100%);
    min-height: 100vh;
    margin: 0;
    padding: 0;
  }

  /* Hero Section */
  .hero-section {
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
    color: white;
    padding: var(--space-16) 0;
    margin-bottom: var(--space-8);
    position: relative;
    overflow: hidden;
  }

  .hero-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="0.5" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    opacity: 0.3;
  }

  .hero-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--space-6);
    text-align: center;
    position: relative;
    z-index: 1;
  }

  .hero-title {
    font-size: 3.5rem;
    font-weight: 800;
    margin: 0 0 var(--space-4);
    background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.1;
  }

  .hero-subtitle {
    font-size: 1.25rem;
    font-weight: 400;
    margin: 0;
    opacity: 0.9;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  /* Alert */
  .alert {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-4);
    border-radius: var(--radius-lg);
    margin: var(--space-6) auto;
    max-width: 1200px;
    font-weight: 500;
  }

  .alert-error {
    background: var(--error-50);
    border: 1px solid var(--error-500);
    color: var(--error-600);
  }

  .alert-icon {
    font-size: 1.25rem;
  }

  /* Controls Section */
  .controls-section {
    max-width: 1200px;
    margin: 0 auto var(--space-8);
    padding: 0 var(--space-6);
  }

  .controls-container {
    background: white;
    border-radius: var(--radius-xl);
    padding: var(--space-6);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--gray-200);
    display: flex;
    gap: var(--space-6);
    align-items: center;
    flex-wrap: wrap;
  }

  .search-container {
    flex: 1;
    min-width: 300px;
  }

  .search-input-wrapper {
    position: relative;
  }

  .search-icon {
    position: absolute;
    left: var(--space-4);
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray-400);
    pointer-events: none;
  }

  #search {
    width: 100%;
    padding: var(--space-4) var(--space-4) var(--space-4) 3rem;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    font-size: 1rem;
    font-family: var(--font-sans);
    transition: var(--transition);
    background: var(--gray-50);
  }

  #search:focus {
    outline: none;
    border-color: var(--primary-500);
    background: white;
    box-shadow: 0 0 0 3px var(--primary-100);
  }

  .controls-group {
    display: flex;
    gap: var(--space-4);
    align-items: center;
  }

  .select-wrapper {
    position: relative;
  }

  .select-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: var(--space-2);
  }

  .select-input {
    padding: var(--space-3) var(--space-4);
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    background: white;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--gray-700);
    cursor: pointer;
    transition: var(--transition);
    min-width: 180px;
  }

  .select-input:focus {
    outline: none;
    border-color: var(--primary-500);
    box-shadow: 0 0 0 3px var(--primary-100);
  }

  .view-toggle {
    display: flex;
    background: var(--gray-100);
    border-radius: var(--radius-lg);
    padding: var(--space-1);
    gap: var(--space-1);
  }

  .view-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border: none;
    background: transparent;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: var(--transition);
    color: var(--gray-500);
  }

  .view-btn:hover {
    background: var(--gray-200);
    color: var(--gray-700);
  }

  .view-btn.active {
    background: white;
    color: var(--primary-600);
    box-shadow: var(--shadow-sm);
  }

  /* Add Course Button */
  .add-course-btn {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-5);
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
    color: white;
    border: none;
    border-radius: var(--radius-lg);
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: var(--shadow-md);
  }

  .add-course-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .add-course-btn:active {
    transform: translateY(0);
  }

  /* Courses Section */
  .courses-section {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--space-6);
  }

  .courses-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: var(--space-6);
  }

  /* Course Cards */
  .course-card {
    background: white;
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--gray-200);
    transition: var(--transition-slow);
    position: relative;
    display: flex;
    flex-direction: column;
  }

  .course-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-xl);
    border-color: var(--primary-200);
  }

  .card-image {
    position: relative;
    height: 200px;
    overflow: hidden;
  }

  .card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: var(--transition-slow);
  }

  .course-card:hover .card-image img {
    transform: scale(1.05);
  }

  .card-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.3) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: var(--transition);
  }

  .course-card:hover .card-overlay {
    opacity: 1;
  }

  .progress-ring {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .progress-ring-svg {
    transform: rotate(-90deg);
  }

  .progress-ring-circle {
    transition: stroke-dashoffset 0.5s ease;
  }

  .progress-text {
    position: absolute;
    font-size: 0.875rem;
    font-weight: 700;
    color: white;
  }

  .card-content {
    padding: var(--space-6);
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .card-header {
    margin-bottom: var(--space-4);
  }

  .course-title {
    margin: 0 0 var(--space-2);
    font-size: 1.25rem;
    font-weight: 700;
    line-height: 1.3;
  }

  .course-title a {
    color: var(--gray-800);
    text-decoration: none;
    transition: var(--transition);
  }

  .course-title a:hover {
    color: var(--primary-600);
  }

  .course-code {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--primary-600);
    background: var(--primary-50);
    padding: var(--space-1) var(--space-3);
    border-radius: var(--radius);
    display: inline-block;
  }

  .card-meta {
    margin-top: auto;
  }

  .department {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    color: var(--gray-600);
    font-size: 0.875rem;
    font-weight: 500;
  }

  .meta-icon {
    color: var(--gray-400);
  }

  .card-footer {
    padding: var(--space-4) var(--space-6) var(--space-6);
    border-top: 1px solid var(--gray-100);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .course-stats {
    display: flex;
    gap: var(--space-4);
  }

  .stat {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .stat-label {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--gray-500);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .stat-value {
    font-size: 0.875rem;
    font-weight: 700;
    color: var(--gray-800);
  }

  .status-active {
    color: var(--success-600);
  }

  .card-action {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border: none;
    background: var(--primary-50);
    color: var(--primary-600);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: var(--transition);
  }

  .card-action:hover {
    background: var(--primary-100);
    transform: translateX(2px);
  }

  .card-actions {
    display: flex;
    gap: var(--space-2);
  }

  .card-action.danger {
    background: var(--error-50);
    color: var(--error-600);
  }

  .card-action.danger:hover {
    background: #fde2e2;
  }

  /* List View */
  .list .courses-grid {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .list .course-card {
    flex-direction: row;
    height: 120px;
  }

  .list .card-image {
    width: 200px;
    height: 100%;
    flex-shrink: 0;
  }

  .list .card-content {
    flex: 1;
    padding: var(--space-4);
  }

  .list .card-footer {
    padding: var(--space-4);
    border-top: none;
    border-left: 1px solid var(--gray-100);
    flex-direction: column;
    justify-content: center;
    min-width: 120px;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: var(--space-20) var(--space-6);
    max-width: 600px;
    margin: 0 auto;
  }

  .empty-icon {
    color: var(--gray-300);
    margin-bottom: var(--space-6);
  }

  .empty-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-800);
    margin: 0 0 var(--space-3);
  }

  .empty-description {
    font-size: 1rem;
    color: var(--gray-600);
    margin: 0;
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;
    animation: fadeIn 0.3s ease-out;
  }

  .modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
  }

  .modal-content {
    position: relative;
    background: white;
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-xl);
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    z-index: 1001;
    animation: slideUp 0.3s ease-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-6);
    border-bottom: 1px solid var(--gray-200);
  }

  .modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-900);
    margin: 0;
  }

  .modal-close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border: none;
    background: var(--gray-100);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: var(--transition);
    color: var(--gray-600);
  }

  .modal-close:hover {
    background: var(--gray-200);
    color: var(--gray-900);
  }

  .modal-form {
    padding: var(--space-6);
  }

  .form-group {
    margin-bottom: var(--space-5);
  }

  .form-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: var(--space-2);
  }

  .form-input {
    width: 100%;
    padding: var(--space-3) var(--space-4);
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    font-size: 1rem;
    font-family: var(--font-sans);
    transition: var(--transition);
    background: var(--gray-50);
  }

  .form-input:focus {
    outline: none;
    border-color: var(--primary-500);
    background: white;
    box-shadow: 0 0 0 3px var(--primary-100);
  }

  .form-message {
    padding: var(--space-3) var(--space-4);
    border-radius: var(--radius-lg);
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: var(--space-4);
    display: none;
  }

  .form-message.success {
    display: block;
    background: var(--success-50);
    color: var(--success-600);
    border: 1px solid var(--success-500);
  }

  .form-message.error {
    display: block;
    background: var(--error-50);
    color: var(--error-600);
    border: 1px solid var(--error-500);
  }

  .modal-actions {
    display: flex;
    gap: var(--space-3);
    justify-content: flex-end;
    margin-top: var(--space-6);
  }

  .btn {
    padding: var(--space-3) var(--space-6);
    border-radius: var(--radius-lg);
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    border: none;
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .btn-primary:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .btn-primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .btn-secondary {
    background: var(--gray-100);
    color: var(--gray-700);
  }

  .btn-secondary:hover {
    background: var(--gray-200);
  }

  .btn-loader {
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* File Upload Section */
  .file-upload-section {
    max-width: 1200px;
    margin: 0 auto var(--space-8);
    padding: 0 var(--space-6);
  }

  .file-upload-container {
    background: white;
    border-radius: var(--radius-xl);
    padding: var(--space-8);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--gray-200);
  }

  .file-upload-title {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--gray-900);
    margin: 0 0 var(--space-2);
  }

  .file-upload-subtitle {
    font-size: 1rem;
    color: var(--gray-600);
    margin: 0 0 var(--space-6);
  }

  .upload-area {
    border: 2px dashed var(--gray-300);
    border-radius: var(--radius-xl);
    padding: var(--space-12);
    text-align: center;
    background: var(--gray-50);
    transition: var(--transition);
    cursor: pointer;
    position: relative;
  }

  .upload-area:hover {
    border-color: var(--primary-500);
    background: var(--primary-50);
  }

  .upload-area.dragover {
    border-color: var(--primary-600);
    background: var(--primary-100);
    transform: scale(1.02);
  }

  .upload-content {
    pointer-events: none;
  }

  .upload-link {
    pointer-events: auto;
  }

  .upload-icon {
    color: var(--primary-500);
    margin: 0 auto var(--space-4);
  }

  .upload-text {
    font-size: 1rem;
    color: var(--gray-700);
    margin: 0 0 var(--space-2);
  }

  .upload-link {
    color: var(--primary-600);
    font-weight: 600;
    text-decoration: underline;
    cursor: pointer;
    pointer-events: auto;
  }

  .upload-hint {
    font-size: 0.875rem;
    color: var(--gray-500);
    margin: 0;
  }

  .upload-progress-container {
    margin-top: var(--space-6);
    padding: var(--space-4);
    background: var(--gray-50);
    border-radius: var(--radius-lg);
  }

  .upload-progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-4);
    font-weight: 600;
    color: var(--gray-700);
  }

  .upload-progress-count {
    font-size: 0.875rem;
    color: var(--gray-500);
  }

  .upload-progress-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .upload-progress-item {
    background: white;
    padding: var(--space-3) var(--space-4);
    border-radius: var(--radius-lg);
    border: 1px solid var(--gray-200);
  }

  .upload-progress-item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-2);
  }

  .upload-progress-item-name {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--gray-700);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    flex: 1;
  }

  .upload-progress-item-status {
    font-size: 0.75rem;
    font-weight: 600;
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius);
  }

  .upload-progress-item-status.uploading {
    background: var(--primary-50);
    color: var(--primary-600);
  }

  .upload-progress-item-status.success {
    background: var(--success-50);
    color: var(--success-600);
  }

  .upload-progress-item-status.error {
    background: var(--error-50);
    color: var(--error-600);
  }

  .upload-progress-bar {
    width: 100%;
    height: 8px;
    background: var(--gray-200);
    border-radius: var(--radius);
    overflow: hidden;
  }

  .upload-progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-500), var(--primary-600));
    transition: width 0.3s ease;
    border-radius: var(--radius);
  }

  .upload-results {
    margin-top: var(--space-6);
    padding: var(--space-4);
    background: var(--success-50);
    border-radius: var(--radius-lg);
    border: 1px solid var(--success-500);
  }

  .upload-results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-4);
  }

  .upload-results-header h3 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--success-700);
    margin: 0;
  }

  .upload-results-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .upload-result-item {
    background: white;
    padding: var(--space-4);
    border-radius: var(--radius-lg);
    border: 1px solid var(--success-200);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-4);
  }

  .upload-result-item-info {
    flex: 1;
    min-width: 0;
  }

  .upload-result-item-name {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: var(--space-1);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .upload-result-item-url {
    font-size: 0.75rem;
    color: var(--primary-600);
    text-decoration: none;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: block;
  }

  .upload-result-item-url:hover {
    text-decoration: underline;
  }

  .upload-result-item-actions {
    display: flex;
    gap: var(--space-2);
  }

  .upload-result-item-btn {
    padding: var(--space-2) var(--space-3);
    border-radius: var(--radius);
    font-size: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: var(--transition);
  }

  .upload-result-item-btn.copy {
    background: var(--primary-50);
    color: var(--primary-600);
  }

  .upload-result-item-btn.copy:hover {
    background: var(--primary-100);
  }

  .upload-result-item-btn.delete {
    background: var(--error-50);
    color: var(--error-600);
  }

  .upload-result-item-btn.delete:hover {
    background: var(--error-100);
  }

  .upload-message {
    margin-top: var(--space-4);
    padding: var(--space-3) var(--space-4);
    border-radius: var(--radius-lg);
    font-size: 0.875rem;
    font-weight: 500;
    display: none;
  }

  .upload-message.success {
    display: block;
    background: var(--success-50);
    color: var(--success-600);
    border: 1px solid var(--success-500);
  }

  .upload-message.error {
    display: block;
    background: var(--error-50);
    color: var(--error-600);
    border: 1px solid var(--error-500);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .hero-title {
      font-size: 2.5rem;
    }
    
    .hero-subtitle {
      font-size: 1.125rem;
    }
    
    .controls-container {
      flex-direction: column;
      align-items: stretch;
    }
    
    .search-container {
      min-width: auto;
    }
    
    .controls-group {
      justify-content: space-between;
    }
    
    .courses-grid {
      grid-template-columns: 1fr;
      gap: var(--space-4);
    }
    
    .list .course-card {
      height: auto;
      flex-direction: column;
    }
    
    .list .card-image {
      width: 100%;
      height: 200px;
    }
    
    .list .card-footer {
      border-left: none;
      border-top: 1px solid var(--gray-100);
      flex-direction: row;
      min-width: auto;
    }
  }

  @media (max-width: 480px) {
    .hero-section {
      padding: var(--space-12) 0;
    }
    
    .hero-title {
      font-size: 2rem;
    }
    
    .controls-container {
      padding: var(--space-4);
    }
    
    .courses-section {
      padding: 0 var(--space-4);
    }
  }
</style>

<script>
  // Check if user is logged in, redirect to login if not
  (function checkAuth() {
    const accessToken = localStorage.getItem('accessToken');
    const idToken = localStorage.getItem('idToken');
    
    // If no tokens, redirect to login page
    if (!accessToken || !idToken) {
      console.log('User not authenticated, redirecting to login...');
      window.location.href = '/login';
      return;
    }
  })();

  (function () {
    const grid = document.getElementById('courseGrid');
    const search = document.getElementById('search');
    const sort = document.getElementById('sort');
    const btnCard = document.getElementById('view-card');
    const btnList = document.getElementById('view-list');
    const CONFIRM_DELETE_MESSAGE = 'Are you sure you want to delete this course? This action cannot be undone.';

    if (!grid || !search || !sort || !btnCard || !btnList) {
      console.warn('Required elements not found');
      return;
    }

    function applySearch() {
      const query = (search.value || '').toLowerCase().trim();
      const cards = grid.querySelectorAll('.course-card');
      
      cards.forEach(card => {
        const name = (card.dataset.name || '').toLowerCase();
        const code = (card.dataset.code || '').toLowerCase();
        const dept = (card.dataset.dept || '').toLowerCase();
        
        const matches = name.includes(query) || 
                       code.includes(query) || 
                       dept.includes(query);
        
        card.style.display = matches ? '' : 'none';
      });
    }

    function applySort() {
      const cards = Array.from(grid.querySelectorAll('.course-card'));
      const [key, direction] = (sort.value || 'name-asc').split('-');
      
      const getValue = (card) => {
        if (key === 'dept') {
          return (card.dataset.dept || '').toLowerCase();
        }
        return (card.dataset.name || '').toLowerCase();
      };
      
      cards.sort((a, b) => {
        const aVal = getValue(a);
        const bVal = getValue(b);
        
        if (aVal < bVal) return direction === 'asc' ? -1 : 1;
        if (aVal > bVal) return direction === 'asc' ? 1 : -1;
        return 0;
      });
      
      // Re-append sorted cards
      cards.forEach(card => grid.appendChild(card));
    }

    function setView(mode) {
      const isList = mode === 'list';
      document.body.classList.toggle('list', isList);
      btnCard.classList.toggle('active', !isList);
      btnList.classList.toggle('active', isList);
      
      // Update grid class for better styling
      grid.className = isList ? 'courses-grid list-view' : 'courses-grid';
    }

    // Event listeners
    search.addEventListener('input', applySearch);
    sort.addEventListener('change', applySort);
    btnCard.addEventListener('click', () => setView('card'));
    btnList.addEventListener('click', () => setView('list'));

    // Initialize
    applySort();
    
    // Add smooth animations
    const style = document.createElement('style');
    style.textContent = `
      .course-card {
        animation: fadeInUp 0.6s ease-out;
      }
      
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .course-card:nth-child(1) { animation-delay: 0.1s; }
      .course-card:nth-child(2) { animation-delay: 0.2s; }
      .course-card:nth-child(3) { animation-delay: 0.3s; }
      .course-card:nth-child(4) { animation-delay: 0.4s; }
      .course-card:nth-child(5) { animation-delay: 0.5s; }
      .course-card:nth-child(6) { animation-delay: 0.6s; }
    `;
    document.head.appendChild(style);

    // Delete course handler (event delegation)
    grid.addEventListener('click', async (e) => {
      const deleteBtn = e.target.closest('.delete-course-btn');
      if (!deleteBtn) return;

      const courseId = deleteBtn.getAttribute('data-course-id');
      const courseName = deleteBtn.getAttribute('data-course-name');
      if (!courseId) return;

      const confirmMsg = `${CONFIRM_DELETE_MESSAGE}\n\nCourse: ${courseName || ''}`.trim();
      const ok = window.confirm(confirmMsg);
      if (!ok) return;

      try {
        const accessToken = localStorage.getItem('accessToken');
        if (!accessToken) {
          alert('You must be logged in to delete a course.');
          return;
        }

        // Optimistic UI: fade out card
        const card = deleteBtn.closest('.course-card');
        if (card) {
          card.style.opacity = '0.5';
        }

        const resp = await fetch(`/api/courses/${courseId}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${accessToken}`
          }
        });

        if (resp.ok) {
          // Remove card from DOM
          if (card) card.remove();
        } else {
          // Revert fade if failed
          if (card) card.style.opacity = '';
          const data = await resp.json().catch(() => ({}));
          alert(data.error || 'Failed to delete course');
        }
      } catch (err) {
        alert('An error occurred while deleting the course.');
      }
    });
  })();

  // Modal functionality
  (function() {
    const modal = document.getElementById('add-course-modal');
    const addBtn = document.getElementById('add-course-btn');
    const closeBtn = document.getElementById('modal-close');
    const cancelBtn = document.getElementById('cancel-btn');
    const overlay = document.getElementById('modal-overlay');
    const form = document.getElementById('add-course-form');
    const formMessage = document.getElementById('form-message');
    const submitBtn = document.getElementById('submit-btn');
    
    // Check if submitBtn exists before accessing its children
    if (!submitBtn) {
      console.warn('Submit button not found, modal functionality may be limited');
      return;
    }
    
    const btnText = submitBtn.querySelector('.btn-text');
    const btnLoader = submitBtn.querySelector('.btn-loader');

    // Open modal
    function openModal() {
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    // Close modal
    function closeModal() {
      modal.classList.remove('active');
      document.body.style.overflow = '';
      form.reset();
      formMessage.className = 'form-message';
      formMessage.textContent = '';
    }

    // Show message
    function showMessage(message, type) {
      formMessage.textContent = message;
      formMessage.className = `form-message ${type}`;
    }

    // Set loading state
    function setLoading(loading) {
      submitBtn.disabled = loading;
      btnText.style.display = loading ? 'none' : 'inline';
      btnLoader.style.display = loading ? 'inline' : 'none';
    }

    // Event listeners
    if (addBtn) {
      addBtn.addEventListener('click', openModal);
    }
    
    if (closeBtn) {
      closeBtn.addEventListener('click', closeModal);
    }
    
    if (cancelBtn) {
      cancelBtn.addEventListener('click', closeModal);
    }
    
    if (overlay) {
      overlay.addEventListener('click', closeModal);
    }

    // Handle form submission
    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = {
          name: document.getElementById('course-name').value,
          code: document.getElementById('course-code').value,
          department: document.getElementById('course-department').value,
          image: document.getElementById('course-image').value || '/images/course-placeholder.png'
        };

        setLoading(true);
        showMessage('', '');

        try {
          const accessToken = localStorage.getItem('accessToken');
          
          const response = await fetch('/api/courses', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${accessToken}`
            },
            body: JSON.stringify(formData)
          });

          const data = await response.json();

          if (response.ok && data.success) {
            showMessage('Course created successfully! Refreshing page...', 'success');
            setTimeout(() => {
              window.location.reload();
            }, 1500);
          } else {
            showMessage(data.error || 'Failed to create course', 'error');
            setLoading(false);
          }
        } catch (error) {
          console.error('Error creating course:', error);
          showMessage('An error occurred. Please try again.', 'error');
          setLoading(false);
        }
      });
    }

    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('active')) {
        closeModal();
      }
    });
  })();

  // File Upload Functionality
  (function() {
    const uploadArea = document.getElementById('upload-area');
    const fileInput = document.getElementById('file-input');
    const uploadProgressContainer = document.getElementById('upload-progress-container');
    const uploadProgressList = document.getElementById('upload-progress-list');
    const uploadProgressCount = document.getElementById('upload-progress-count');
    const uploadResults = document.getElementById('upload-results');
    const uploadResultsList = document.getElementById('upload-results-list');
    const uploadMessage = document.getElementById('upload-message');
    const clearResultsBtn = document.getElementById('clear-results-btn');

    // Check if required elements exist
    if (!uploadArea || !fileInput) {
      console.warn('File upload elements not found');
      return;
    }

    let uploadedFiles = [];

    // Show message
    function showMessage(message, type) {
      uploadMessage.textContent = message;
      uploadMessage.className = `upload-message ${type}`;
      setTimeout(() => {
        uploadMessage.className = 'upload-message';
        uploadMessage.textContent = '';
      }, 5000);
    }

    // Format file size
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    // Create progress item
    function createProgressItem(fileName, fileSize) {
      const item = document.createElement('div');
      item.className = 'upload-progress-item';
      item.dataset.fileName = fileName;
      item.innerHTML = `
        <div class="upload-progress-item-header">
          <span class="upload-progress-item-name">${fileName}</span>
          <span class="upload-progress-item-status uploading">Uploading...</span>
        </div>
        <div class="upload-progress-bar">
          <div class="upload-progress-bar-fill" style="width: 0%"></div>
        </div>
      `;
      return item;
    }

    // Update progress
    function updateProgress(fileName, progress) {
      if (!uploadProgressList) return;
      const item = uploadProgressList.querySelector(`[data-file-name="${fileName}"]`);
      if (item) {
        const fill = item.querySelector('.upload-progress-bar-fill');
        if (fill) {
          fill.style.width = `${progress}%`;
        }
      }
    }

    // Mark progress as complete
    function markProgressComplete(fileName, success, error) {
      if (!uploadProgressList) return;
      const item = uploadProgressList.querySelector(`[data-file-name="${fileName}"]`);
      if (item) {
        const status = item.querySelector('.upload-progress-item-status');
        const fill = item.querySelector('.upload-progress-bar-fill');
        if (status) {
          status.className = `upload-progress-item-status ${success ? 'success' : 'error'}`;
          status.textContent = success ? 'Uploaded' : (error || 'Failed');
        }
        if (fill) {
          fill.style.width = success ? '100%' : '0%';
          fill.style.background = success ? 'linear-gradient(90deg, var(--success-500), var(--success-600))' : 'var(--error-500)';
        }
      }
    }

    // Create result item
    function createResultItem(file) {
      const item = document.createElement('div');
      item.className = 'upload-result-item';
      item.dataset.key = file.key;
      item.innerHTML = `
        <div class="upload-result-item-info">
          <div class="upload-result-item-name">${file.originalName}</div>
          <a href="${file.url}" target="_blank" class="upload-result-item-url">${file.url}</a>
        </div>
        <div class="upload-result-item-actions">
          <button class="upload-result-item-btn copy" data-url="${file.url}">Copy URL</button>
          <button class="upload-result-item-btn delete" data-key="${file.key}">Delete</button>
        </div>
      `;
      return item;
    }

    // Upload file using pre-signed URL
    async function uploadFile(file) {
      const accessToken = localStorage.getItem('accessToken');
      if (!accessToken) {
        showMessage('You must be logged in to upload files', 'error');
        return null;
      }

      // Validate file size
      if (file.size > 10 * 1024 * 1024) {
        markProgressComplete(file.name, false, 'File size exceeds 10MB limit');
        return null;
      }

      try {
        // Step 1: Request pre-signed URL from backend
        updateProgress(file.name, 5);
        
        // Step 1: Request pre-signed URL from backend
        const presignedResponse = await fetch('/api/files/presigned-url', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${accessToken}`
          },
          body: JSON.stringify({
            fileName: file.name,
            mimeType: file.type || 'application/octet-stream',
            folder: 'uploads'
          })
        });

        if (!presignedResponse.ok) {
          const errorData = await presignedResponse.json();
          markProgressComplete(file.name, false, errorData.error || 'Failed to get upload URL');
          return null;
        }

        const presignedData = await presignedResponse.json();
        if (!presignedData.success) {
          markProgressComplete(file.name, false, presignedData.error || 'Failed to get upload URL');
          return null;
        }

        updateProgress(file.name, 15);

        // Step 2: Upload file directly to S3 using pre-signed URL
        // Use XMLHttpRequest for better progress tracking
        const uploadPromise = new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          
          // Track upload progress
          xhr.upload.addEventListener('progress', (e) => {
            if (e.lengthComputable) {
              const percentComplete = 15 + (e.loaded / e.total) * 80; // 15% to 95%
              updateProgress(file.name, Math.min(percentComplete, 95));
            }
          });

          xhr.addEventListener('load', () => {
            if (xhr.status >= 200 && xhr.status < 300) {
              updateProgress(file.name, 100);
              resolve(xhr);
            } else {
              reject(new Error(`Upload failed with status ${xhr.status}`));
            }
          });

          xhr.addEventListener('error', () => {
            reject(new Error('Upload failed'));
          });

          xhr.addEventListener('abort', () => {
            reject(new Error('Upload aborted'));
          });

          xhr.open('PUT', presignedData.uploadUrl);
          xhr.setRequestHeader('Content-Type', file.type || 'application/octet-stream');
          xhr.send(file);
        });

        await uploadPromise;

        // Step 3: Construct the public URL
        // The URL format depends on your bucket configuration
        // For public buckets: https://bucket-name.s3.region.amazonaws.com/key
        // For CloudFront: https://your-cloudfront-domain.net/key
        const bucketName = presignedData.bucket;
        const region = presignedData.region || 'us-east-1';
        const key = presignedData.key;
        
        // Construct S3 URL (adjust based on your bucket's public access settings)
        // If your bucket is public, this will work. Otherwise, you may need CloudFront URL
        const fileUrl = `https://${bucketName}.s3.${region}.amazonaws.com/${key}`;

        markProgressComplete(file.name, true);

        return {
          url: fileUrl,
          key: key,
          originalName: file.name,
          size: file.size,
          mimeType: file.type || 'application/octet-stream',
          uploadedAt: new Date().toISOString()
        };

      } catch (error) {
        markProgressComplete(file.name, false, error.message || 'Upload failed');
        return null;
      }
    }

    // Upload multiple files
    async function uploadFiles(files) {
      if (files.length === 0) return;

      // Show progress container
      if (uploadProgressContainer) uploadProgressContainer.style.display = 'block';
      if (uploadProgressList) uploadProgressList.innerHTML = '';
      if (uploadProgressCount) uploadProgressCount.textContent = `${files.length} file(s)`;

      // Create progress items
      Array.from(files).forEach(file => {
        const item = createProgressItem(file.name, file.size);
        if (uploadProgressList) uploadProgressList.appendChild(item);
      });

      // Upload files sequentially
      const results = [];
      for (const file of files) {
        const result = await uploadFile(file);
        if (result) {
          results.push(result);
        }
      }

      // Hide progress after a delay
      setTimeout(() => {
        if (uploadProgressContainer) uploadProgressContainer.style.display = 'none';
      }, 2000);

      // Show results
      if (results.length > 0) {
        uploadedFiles = [...uploadedFiles, ...results];
        displayResults();
        showMessage(`Successfully uploaded ${results.length} file(s)`, 'success');
      } else {
        showMessage('Failed to upload files', 'error');
      }
    }

    // Display results
    function displayResults() {
      if (!uploadResults || !uploadResultsList) return;
      uploadResults.style.display = 'block';
      uploadResultsList.innerHTML = '';
      uploadedFiles.forEach(file => {
        const item = createResultItem(file);
        uploadResultsList.appendChild(item);
      });
    }

    // Handle file input change
    fileInput.addEventListener('change', (e) => {
      const files = e.target.files;
      if (files.length > 0) {
        uploadFiles(files);
        fileInput.value = ''; // Reset input
      }
    });

    // Drag and drop handlers
    uploadArea.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (fileInput) {
        fileInput.click();
      }
    });

    // Also make the "click to browse" link work
    const uploadLink = uploadArea.querySelector('.upload-link');
    if (uploadLink) {
      uploadLink.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        if (fileInput) {
          fileInput.click();
        }
      });
    }

    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        uploadFiles(files);
      }
    });

    // Copy URL handler
    uploadResultsList.addEventListener('click', async (e) => {
      if (e.target.classList.contains('copy')) {
        const url = e.target.dataset.url;
        try {
          await navigator.clipboard.writeText(url);
          showMessage('URL copied to clipboard!', 'success');
        } catch (err) {
          // Fallback for older browsers
          const textarea = document.createElement('textarea');
          textarea.value = url;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
          showMessage('URL copied to clipboard!', 'success');
        }
      }
    });

    // Delete file handler
    uploadResultsList.addEventListener('click', async (e) => {
      if (e.target.classList.contains('delete')) {
        const key = e.target.dataset.key;
        const item = e.target.closest('.upload-result-item');
        
        if (!confirm('Are you sure you want to delete this file?')) {
          return;
        }

        const accessToken = localStorage.getItem('accessToken');
        if (!accessToken) {
          showMessage('You must be logged in to delete files', 'error');
          return;
        }

        try {
          const response = await fetch(`/api/files/${encodeURIComponent(key)}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${accessToken}`
            }
          });

          const data = await response.json();

          if (response.ok && data.success) {
            uploadedFiles = uploadedFiles.filter(f => f.key !== key);
            if (item) item.remove();
            if (uploadedFiles.length === 0) {
              uploadResults.style.display = 'none';
            }
            showMessage('File deleted successfully', 'success');
          } else {
            showMessage(data.error || 'Failed to delete file', 'error');
          }
        } catch (error) {
          showMessage('An error occurred while deleting the file', 'error');
        }
      }
    });

    // Clear results handler
    if (clearResultsBtn) {
      clearResultsBtn.addEventListener('click', () => {
        uploadedFiles = [];
        uploadResults.style.display = 'none';
        uploadResultsList.innerHTML = '';
      });
    }
  })();
</script>
